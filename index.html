<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGrid - Professional Edition</title>
    <style>
        :root { --wind-speed: 2s; --main-green: #2ecc71; --dark-green: #27ae60; --neon-blue: #00d2ff; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Inter', sans-serif; background: #2d3436; }

        /* MAPPA CON PROFONDITÃ€ */
        #game-viewport {
            width: 100vw; height: 100vh;
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            background-image: 
                radial-gradient(circle at 2px 2px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 40px 40px;
            position: relative; transition: all 2s;
        }
        .night-mode #game-viewport { background: linear-gradient(135deg, #1b3022 0%, #0c1a12 100%); filter: brightness(0.7); }

        /* SOLE REALISTICO */
        #sun {
            position: absolute; top: 10%; left: 50%; transform: translateX(-50%);
            width: 100px; height: 100px; background: radial-gradient(circle, #fff700 0%, #f39c12 100%);
            border-radius: 50%; box-shadow: 0 0 80px rgba(241, 196, 15, 0.6); z-index: 2; transition: top 3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .night-mode #sun { top: 120%; }

        /* DASHBOARD MODERNA */
        .dashboard {
            position: fixed; bottom: 30px; right: 30px;
            background: rgba(15, 15, 15, 0.9); border: 1px solid rgba(0, 255, 65, 0.3);
            backdrop-filter: blur(10px); color: #00ff41; padding: 20px;
            border-radius: 20px; width: 260px; z-index: 1000;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .data-label { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .data-value { font-size: 18px; font-weight: bold; margin-bottom: 10px; font-family: monospace; }

        /* ASSET ISOMETRICI */
        .asset { position: absolute; z-index: 10; filter: drop-shadow(15px 15px 10px rgba(0,0,0,0.2)); }
        
        /* BATTERIA STILIZZATA */
        .battery-case { fill: #2c3e50; }
        .battery-fill { transition: height 0.5s ease; fill: #00ff41; filter: drop-shadow(0 0 5px #00ff41); }

        /* ANIMAZIONE PALE */
        .blades { transform-origin: center; animation: spin var(--wind-speed) linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* CONTROLLI UI */
        .controls {
            position: fixed; bottom: 30px; left: 30px;
            display: flex; gap: 15px; align-items: center;
            background: rgba(255,255,255,0.1); padding: 15px 25px;
            border-radius: 50px; backdrop-filter: blur(10px); z-index: 1000;
        }
        input[type=range] { accent-color: #2ecc71; cursor: pointer; }
        button { 
            background: #27ae60; border: none; color: white; padding: 10px 20px; 
            border-radius: 20px; cursor: pointer; transition: 0.3s; font-weight: bold;
        }
        button:hover { background: #2ecc71; transform: translateY(-2px); }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="sun"></div>

    <svg class="asset" style="top:20%; right:0; width:35%; height:60px;">
        <rect fill="url(#riverGrad)" width="100%" height="30" rx="15" />
        <defs>
            <linearGradient id="riverGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#2980b9" />
                <stop offset="100%" style="stop-color:#3498db" />
            </linearGradient>
        </defs>
    </svg>

    <svg class="asset" style="top:15%; left:15%; width:100px;" viewBox="0 0 100 100">
        <path d="M45 90 L55 90 L52 40 L48 40 Z" fill="#bdc3c7"/>
        <g class="blades" style="transform-box: fill-box; transform-origin: center;">
            <circle cx="50" cy="40" r="3" fill="#7f8c8d"/>
            <path d="M50 40 L50 10 L54 10 Z" fill="#ecf0f1"/>
            <path d="M50 40 L80 55 L78 58 Z" fill="#ecf0f1"/>
            <path d="M50 40 L20 55 L22 58 Z" fill="#ecf0f1"/>
        </g>
    </svg>

    <svg id="thermal-plant" class="asset" style="top:15%; left:75%; width:120px" viewBox="0 0 100 80">
        <rect x="20" y="40" width="60" height="30" fill="#34495e"/> <rect x="25" y="40" width="15" height="15" fill="#2c3e50"/> <rect x="60" y="10" width="12" height="40" fill="#7f8c8d"/> <rect x="60" y="10" width="12" height="5" fill="#e74c3c"/> </svg>

    <div style="position:absolute; top:45%; left:40%;">
        <svg class="asset" width="60" height="60" style="top:0; left:0">
            <path d="M10 50 L40 50 L40 25 L10 25 Z" fill="#e74c3c"/> <path d="M40 50 L55 40 L55 15 L40 25 Z" fill="#c0392b"/> <path d="M10 25 L40 25 L55 15 L25 15 Z" fill="#ff7675"/> </svg>
        <svg class="asset" width="60" height="60" style="top:40px; left:80px">
            <path d="M10 50 L40 50 L40 25 L10 25 Z" fill="#3498db"/>
            <path d="M40 50 L55 40 L55 15 L40 25 Z" fill="#2980b9"/>
            <path d="M10 25 L40 25 L55 15 L25 15 Z" fill="#74b9ff"/>
        </svg>
    </div>

    <svg class="asset" style="top:70%; left:20%; width:80px" viewBox="0 0 60 80">
        <rect class="battery-case" x="10" y="10" width="40" height="60" rx="5"/>
        <rect class="battery-fill" id="phys-batt" x="15" y="65" width="30" height="0"/>
        <rect x="25" y="5" width="10" height="5" fill="#2c3e50"/>
    </svg>

    <div style="position:absolute; bottom:20%; right:35%;">
        <svg class="asset" width="100" height="40"><rect fill="#2c3e50" width="80" height="30" rx="2" skewX="-20" /><path d="M0 15 H80 M20 0 V30 M40 0 V30 M60 0 V30" stroke="rgba(255,255,255,0.1)"/></svg>
    </div>
</div>

<div class="dashboard">
    <div class="data-label">Network Load</div>
    <div class="data-value" id="db-demand">0 MW</div>
    <div class="data-label">Renewable Energy</div>
    <div class="data-value" id="db-renew">0 MW</div>
    <div class="data-label">Battery Storage</div>
    <div class="data-value" id="db-batt">50%</div>
    <div class="data-label">Status</div>
    <div class="data-value" id="db-status" style="font-size: 14px;">BALANCED</div>
</div>

<div class="controls">
    <div style="color:white; font-size: 12px;">ðŸ•’ <span id="clock">12:00</span></div>
    <input type="range" id="thermal-slider" value="0">
    <button id="toggle-batt">USE BATTERY</button>
</div>

<script>
    let time = 12;
    let battery = 50;
    let isBattActive = false;

    document.getElementById('toggle-batt').onclick = () => {
        isBattActive = !isBattActive;
        document.getElementById('toggle-batt').style.background = isBattActive ? '#e67e22' : '#27ae60';
    };

    function gameLoop() {
        time = (time + 0.01) % 24;
        const clockStr = Math.floor(time).toString().padStart(2, '0') + ":00";
        document.getElementById('clock').innerText = clockStr;
        
        const isNight = time > 19 || time < 6;
        document.body.classList.toggle('night-mode', isNight);

        // Simulazione Ambiente
        let wind = 30 + Math.sin(time) * 20 + Math.random() * 5;
        let sun = isNight ? 0 : Math.max(0, 100 * Math.sin((time - 6) * Math.PI / 13));
        
        // Produzione e Consumo
        const thermal = parseInt(document.getElementById('thermal-slider').value);
        const demand = isNight ? 50 : 130;
        let renewable = Math.floor(wind + sun);
        let balance = (renewable + thermal) - demand;

        // Gestione Batteria
        if (balance > 0) {
            battery = Math.min(100, battery + 0.1);
        } else if (isBattActive && battery > 0) {
            battery = Math.max(0, battery - 0.2);
            balance += 40; // La batteria immette 40MW
        }

        // Update Grafico Asset
        document.documentElement.style.setProperty('--wind-speed', (120 - wind)/25 + 's');
        document.getElementById('phys-batt').setAttribute('height', (battery * 0.5));
        document.getElementById('phys-batt').setAttribute('y', 65 - (battery * 0.5));

        // Update Dashboard
        document.getElementById('db-demand').innerText = demand + " MW";
        document.getElementById('db-renew').innerText = renewable + " MW";
        document.getElementById('db-batt').innerText = Math.floor(battery) + "%";
        
        const statusEl = document.getElementById('db-status');
        if (balance < -5) {
            statusEl.innerText = "CRITICAL DEFICIT"; statusEl.style.color = "#ff7675";
        } else if (balance > 20) {
            statusEl.innerText = "EXCESS ENERGY"; statusEl.style.color = "#55efc4";
        } else {
            statusEl.innerText = "BALANCED"; statusEl.style.color = "#00ff41";
        }

        requestAnimationFrame(gameLoop);
    }
    gameLoop();
</script>
</body>
</html>
